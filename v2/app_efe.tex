%% ============================
%%
%% Appendix A
%%
%% ============================

\chapter{Derivation of Eistein field equations}
\label{app:efe}
%% \externaldocument{intro}
%% --------------------------------------


\section{Euler-Lagrange equations}

The action principle of the Lagrangian field theory on the spacetime $(\mathcal{M}; \boldsymbol{g})$ is
\begin{equation}
S(\boldsymbol{q}, \nabla\boldsymbol{q}) = \int_{\mathcal{M}}\boldsymbol{\alpha}\mathcal{L}(\boldsymbol{q}, \nabla\boldsymbol{q}),
\end{equation}
where $\boldsymbol{q}$ are a set of generalized coordinates for the fields described by the theory, $\nabla$ is the Levi-Civita connection, $\mathcal{L}$ is a scalar density of a scalar quantity $\lambda$ as $\lambda(\boldsymbol{q},\nabla\boldsymbol{q})$. 

Varying the action with respect to the $\boldsymbol{q}$
\begin{equation}
\delta S(\boldsymbol{q}, \nabla\boldsymbol{q}) = \delta\int\boldsymbol{\alpha}\mathcal{L}(\boldsymbol{q}, \nabla\boldsymbol{q}) = \int\boldsymbol{\alpha}\Big(\frac{\partial\mathcal{L}}{\partial\boldsymbol{q}}\delta\boldsymbol{q}+\frac{\partial\mathcal{L}}{\partial(\nabla\boldsymbol{q})}\delta\nabla\boldsymbol{q}\Big)
\end{equation}

As $\delta$ and $\nabla$ commute, and partially integrating $\nabla$, we obtain

\begin{equation}
\partial S(\boldsymbol{q}, \nabla\boldsymbol{q}) = \int\boldsymbol{\alpha}\Big(\frac{\mathcal{L}}{\partial\boldsymbol{q}}-\nabla\frac{\partial \mathcal{L}}{\partial(\nabla\boldsymbol{q})}\Big)\delta\boldsymbol{q} + \int_{\mathcal{M}}\boldsymbol{\alpha}\nabla\Big(\frac{\partial\mathcal{L}}{\partial(\nabla\boldsymbol{q})}\delta\boldsymbol{q}\Big)
\end{equation}

The last term is a boundary term and in order to vanish we impose boundary condition. Assume that the fields are defined over only a compact domain. \\
As the choice of $\partial\boldsymbol{q}$ is arbitrary, the 

\begin{equation}
\partial S(\boldsymbol{q}, \nabla\boldsymbol{q}) = 0
\end{equation}

and the Euler-Lagrange equations are

\begin{equation}
\frac{\partial \mathcal{L}}{\partial\boldsymbol{q}} - \nabla\Big(\frac{\partial\mathcal{L}}{\partial(\nabla\boldsymbol{q})}\Big) = 0
\label{eq:theory:eulerlagrange}
\end{equation}

%% ----------------------------------------------- 
\section{The Hilbert Action}

The Einsteinâ€“Hilbert action allows to obtain an Einstein field equations through ad principle of least action. Here we briefly underline the procedure.

Introduce action that describes the graviatational field, and a matter field $\mathcal{L}_m$:
\begin{align}
S_g &= \int\frac{1}{2\kappa}R\epsilon, \\
S_m &= \int\mathcal{L}_{m}\epsilon,
\end{align}
where $R$ is the Ricci scalar and $\kappa$ is the  Einstein's constant. \\

The full action then:
\begin{equation}
S = \int\Big(\frac{1}{2\kappa}R+\mathcal{L}_m\Big)\epsilon
\end{equation}

The action principle dicatates, that $\delta S = 0$  with respect to the inverse metric $g^{\mu\nu}$. 

\begin{equation}
\int\Bigg[\frac{1}{2\kappa}\Big(\frac{\delta R}{\delta g^{\mu\nu}}+\frac{R}{\sqrt{-g}}\frac{\delta\sqrt{-g}}{\delta g^{\mu\nu}}\Big) + \frac{1}{\sqrt{-g}}\frac{\delta(\sqrt{-g}\mathcal{L}_m)}{\delta g^{\mu\nu}}\Bigg]\delta g^{\mu\nu}\epsilon
\end{equation}

Owing to the arbitrariness of $\delta g^{\mu\nu}$, the integrant must be zero. 

\begin{equation}
\frac{\delta R}{\delta g^{\mu\nu}} + \frac{R}{\sqrt{-g}}\frac{\delta\sqrt{-g}}{\delta g^{\mu\nu}} = -2\kappa\frac{1}{\sqrt{-g}}\frac{\delta(\sqrt{-g}\mathcal{L}_m)}{\delta g^{\mu\nu}} = -\frac{2\kappa}{\sqrt{-g}}\frac{\delta S_m}{\delta g_{\mu\nu}} := \kappa T_{\mu\nu},
\label{eq:theory:action1}
\end{equation}
where we introduced the stress-energy tensor $T_{\mu\nu}$ and te matter action $S_m$ for future use. \\

\todo{this matter action is used in deriving the $T_{\mu} ^{\nu}$ i the invariant fluid formalisn}

The continuation of this deriviation requires taking variation of the Riccia scalar $R$ and the determinantof the metric $\sqrt{-g}$. As this is a length procedure, we provide here the result. 

\begin{equation}
\frac{\delta R}{\delta g^{\mu\nu}} = R_{\mu\nu},
\label{eq:theory:deltaR}
\end{equation}
where the $R_{\mu\nu}$ is the Ricci curvature tensor.

\begin{equation}
\frac{1}{\sqrt{-g}}\frac{\delta\sqrt{-g}}{\delta g^{\mu\nu}} = -\frac{1}{2}g_{\mu\nu}.
\label{eq:theory:deltagmuny}
\end{equation}

Substituting Eq. \ref{eq:theory:deltaR} and Eq. \ref{eq:theory:deltagmuny} into equation of motion Eq.  \ref{eq:theory:action1} we obtain the Einstein's field equation 

\begin{equation}
R_{\mu\nu} -\frac{1}{2}g_{\mu\nu}R=8\pi T_{\mu\nu},
%% \label{eq:theory:EFE}
\end{equation}
where in the geometrized unit system, \textit{i.e} $c=G=1$, the $\kappa=8\pi$.